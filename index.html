<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Currency Converter</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* Custom styles for a consistent look and feel */
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom focus ring for better accessibility */
        .custom-focus-ring:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(96, 165, 250, 0.6);
        }
        /* Custom spinner animation */
        .spinner {
            border-color: transparent;
            border-top-color: #3B82F6; /* blue-500 */
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 flex items-center justify-center min-h-screen transition-colors duration-300">

    <div class="w-full max-w-md mx-4">
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-lg p-6 md:p-8">
            <div class="flex items-center gap-4 mb-6">
                 <!-- Icon for the converter -->
                <div class="bg-blue-500 p-2 rounded-xl">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-800 dark:text-white">Currency Converter</h1>
            </div>

            <!-- Conversion Form -->
            <form id="converter-form" class="space-y-6">
                <!-- Amount Input -->
                <div>
                    <label for="amount" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">Amount</label>
                    <input type="number" id="amount" name="amount" value="100" class="w-full bg-gray-50 dark:bg-gray-700 border-2 border-gray-200 dark:border-gray-600 rounded-xl p-3 text-gray-800 dark:text-white focus:border-blue-500 custom-focus-ring transition-shadow" placeholder="100.00">
                </div>

                <!-- From/To Currency Row -->
                <div class="flex items-center justify-between gap-4">
                    <!-- From Currency -->
                    <div class="w-full">
                        <label for="from-currency" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">From</label>
                        <select id="from-currency" name="from-currency" class="w-full bg-gray-50 dark:bg-gray-700 border-2 border-gray-200 dark:border-gray-600 rounded-xl p-3 text-gray-800 dark:text-white focus:border-blue-500 custom-focus-ring transition-shadow appearance-none"></select>
                    </div>

                    <!-- Swap Button -->
                    <button type="button" id="swap-button" class="mt-8 p-2 bg-gray-200 dark:bg-gray-600 rounded-full hover:bg-blue-500 hover:text-white group transition-all duration-300 transform hover:rotate-180 focus:outline-none custom-focus-ring">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-600 dark:text-gray-300 group-hover:text-white transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                          <path stroke-linecap="round" stroke-linejoin="round" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" />
                        </svg>
                    </button>

                    <!-- To Currency -->
                    <div class="w-full">
                        <label for="to-currency" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-2">To</label>
                        <select id="to-currency" name="to-currency" class="w-full bg-gray-50 dark:bg-gray-700 border-2 border-gray-200 dark:border-gray-600 rounded-xl p-3 text-gray-800 dark:text-white focus:border-blue-500 custom-focus-ring transition-shadow appearance-none"></select>
                    </div>
                </div>

                <!-- Result Display -->
                <div class="pt-2 text-center">
                    <p id="loading-spinner" class="text-gray-500 dark:text-gray-400 hidden">
                        <span class="inline-block w-5 h-5 border-2 rounded-full spinner mr-2"></span>
                        Fetching rates...
                    </p>
                    <div id="result-container" class="hidden">
                         <p class="text-gray-600 dark:text-gray-400 text-lg" id="base-result-text"></p>
                         <p class="text-3xl font-bold text-gray-900 dark:text-white" id="final-result-text"></p>
                    </div>
                    <p id="error-message" class="text-red-500 mt-2"></p>
                </div>
            </form>
        </div>
        <footer class="text-center mt-4 text-sm text-gray-500 dark:text-gray-400">
            <p>Exchange rates updated from <a href="https://www.frankfurter.app" target="_blank" class="underline hover:text-blue-500">Frankfurter API</a>.</p>
        </footer>
    </div>

    <script>
        const amountEl = document.getElementById('amount');
        const fromCurrencyEl = document.getElementById('from-currency');
        const toCurrencyEl = document.getElementById('to-currency');
        const swapButton = document.getElementById('swap-button');
        const form = document.getElementById('converter-form');
        const resultContainer = document.getElementById('result-container');
        const baseResultText = document.getElementById('base-result-text');
        const finalResultText = document.getElementById('final-result-text');
        const errorMessageEl = document.getElementById('error-message');
        const loadingSpinner = document.getElementById('loading-spinner');

        // Frankfurter API URL
        const API_URL = 'https://api.frankfurter.app';

        // Fetch currencies and populate dropdowns
        async function populateCurrencies() {
            try {
                const response = await fetch(`${API_URL}/currencies`);
                if (!response.ok) throw new Error('Failed to fetch currency list.');
                
                const currencies = await response.json();
                
                const fragment = document.createDocumentFragment();
                for (const currencyCode in currencies) {
                    // Skip ILS from the list
                    if (currencyCode === 'ILS') {
                        continue;
                    }
                    const option = document.createElement('option');
                    option.value = currencyCode;
                    option.textContent = `${currencyCode} - ${currencies[currencyCode]}`;
                    fragment.appendChild(option);
                }

                fromCurrencyEl.appendChild(fragment.cloneNode(true));
                toCurrencyEl.appendChild(fragment);

                // Set default values
                fromCurrencyEl.value = 'USD';
                toCurrencyEl.value = 'EUR';

                // Initial conversion on load
                convertCurrency();

            } catch (error) {
                showError('Could not load currencies. Please try again later.');
                console.error(error);
            }
        }

        // Handle currency conversion
        async function convertCurrency() {
            const amount = parseFloat(amountEl.value);
            const fromCurrency = fromCurrencyEl.value;
            const toCurrency = toCurrencyEl.value;
            
            // Reset UI
            errorMessageEl.textContent = '';
            resultContainer.classList.add('hidden');
            if (amount > 0) {
                 loadingSpinner.classList.remove('hidden');
            }

            if (isNaN(amount) || amount <= 0) {
                loadingSpinner.classList.add('hidden');
                baseResultText.textContent = 'Enter a valid amount to convert.';
                finalResultText.textContent = '';
                resultContainer.classList.remove('hidden');
                return;
            }

            if (fromCurrency === toCurrency) {
                loadingSpinner.classList.add('hidden');
                baseResultText.textContent = `${formatCurrency(amount, fromCurrency)} is`;
                finalResultText.textContent = formatCurrency(amount, toCurrency);
                resultContainer.classList.remove('hidden');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/latest?amount=${amount}&from=${fromCurrency}&to=${toCurrency}`);
                if (!response.ok) throw new Error('Failed to fetch exchange rates.');

                const data = await response.json();
                const convertedAmount = data.rates[toCurrency];

                // Display result
                baseResultText.textContent = `${formatCurrency(amount, fromCurrency)} is`;
                finalResultText.textContent = formatCurrency(convertedAmount, toCurrency);
                resultContainer.classList.remove('hidden');

            } catch (error) {
                showError('Unable to fetch exchange rates. Please check your connection.');
                console.error(error);
            } finally {
                loadingSpinner.classList.add('hidden');
            }
        }
        
        // Format numbers as currency
        function formatCurrency(value, currency) {
            try {
                return new Intl.NumberFormat('en-US', {
                    style: 'currency',
                    currency: currency,
                    minimumFractionDigits: 2,
                    maximumFractionDigits: 2
                }).format(value);
            } catch (e) {
                // Fallback for less common currency codes not supported by Intl
                return `${currency} ${value.toFixed(2)}`;
            }
        }

        // Show error message
        function showError(message) {
            errorMessageEl.textContent = message;
            resultContainer.classList.add('hidden');
        }

        // Event Listeners
        form.addEventListener('input', convertCurrency);
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            convertCurrency();
        });

        swapButton.addEventListener('click', () => {
            const temp = fromCurrencyEl.value;
            fromCurrencyEl.value = toCurrencyEl.value;
            toCurrencyEl.value = temp;
            convertCurrency();
        });

        // Initialize
        document.addEventListener('DOMContentLoaded', populateCurrencies);
    </script>

</body>
</html>
